{% extends "header.html" %}

{% block title %}
Задачи - FMI
{% endblock %}

{% block extra_css %}
<style>
    /* Layout */
    .page-container {
        display: flex;
        min-height: calc(100vh - 60px); /* Изваждаме височината на header */
    }

    /* Странична навигация */
    .sidebar {
        width: 250px;
        background-color: #135ea9;
        padding: 20px;
        border-right: 1px solid #dee2e6;
    }

    .sidebar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .add-list-button {
        background-color: #6c757d;
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }

    .todo-lists {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .list-item {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        border-radius: 4px;
        color: #495057;
        text-decoration: none;
        transition: background-color 0.2s;
    }

    .list-item:hover {
        background-color: #e9ecef;
    }

    .list-item.active {
        background-color: #e9ecef;
        font-weight: bold;
    }

    /* Основно съдържание */
    .main-content {
        flex-grow: 1;
        padding: 20px;
    }

    .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .add-task-button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    .add-task-button:hover {
        background-color: #45a049;
    }

    /* Грид със задачи */
    .todo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }

    .todo-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .priority-1 { border-left: 4px solid #28a745; }
    .priority-2 { border-left: 4px solid #ffc107; }
    .priority-3 { border-left: 4px solid #dc3545; }

    .todo-title {
        font-size: 1.1em;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .todo-description {
        color: #666;
        font-size: 0.9em;
        margin-bottom: 8px;
    }

    .todo-status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.9em;
        margin-top: 10px;
    }

    .phase-todo { background-color: #f8f9fa; }
    .phase-in_progress { background-color: #fff3cd; }
    .phase-done { background-color: #d4edda; }

    .deadline {
        color: #666;
        font-size: 0.9em;
    }

    .overdue {
        color: #dc3545;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Странична навигация с листове -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>Моите списъци</h3>
            <button class="add-list-button" onclick="window.location.href='/tasks/lists/add'">
                + Нов лист
            </button>
        </div>
        <div class="todo-lists">
            <a href="{% url 'tasks:tasks' %}" class="list-item {% if not current_list %}active{% endif %}">
                Всички задачи
            </a>
            {% for list in todo_lists %}
            <a href="{% url 'tasks:tasks' %}?list={{ list.id }}" 
               class="list-item {% if current_list.id == list.id %}active{% endif %}">
                {{ list.name }}
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Основно съдържание -->
    <div class="main-content">
        <div class="content-header">
            <h1>{{ current_list.name|default:"Всички задачи" }}</h1>
            <button class="add-task-button" onclick="window.location.href='/tasks/add'">
                + Добави задача
            </button>           
        </div>        

        <div class="todo-grid">
            {% for todo in tasks %}
            <div class="todo-card priority-{{ todo.priority }}">
                <div class="todo-title">{{ todo.title }}</div>
                
                {% if todo.description %}
                <div class="todo-description">{{ todo.description }}</div>
                {% endif %}
                
                <div class="todo-status phase-{{ todo.phase }}">
                    {{ todo.get_phase_display }}
                </div>
                
                <div class="deadline {% if todo.deadline|date:'Y-m-d' < now|date:'Y-m-d' %}overdue{% endif %}">
                    Краен срок: {{ todo.deadline|date:"d.m.Y" }}
                </div>
            </div>
            {% empty %}
            <p>Няма намерени задачи в този лист.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}